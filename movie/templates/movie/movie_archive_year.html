{% extends 'base.html' %}
{% load static %}

{% block body %}
<main class="container mt-4">

  <!-- üé¨ Movie Filters -->
  <section class="text-center mb-4">
    <h2 class="fw-bold text-primary">üé¨ Browse Movies</h2>

    <div class="d-flex justify-content-center flex-wrap gap-3 my-4">
      <!-- Genre -->
      <div>
        <label class="fw-semibold me-2">Genre:</label>
        <div class="btn-group" role="group">
          {% for cat in genres %}
            <a href="?category={{ cat }}" class="btn btn-sm {% if selected_category == cat %}btn-primary{% else %}btn-outline-primary{% endif %}">{{ cat|title }}</a>
          {% endfor %}
        </div>
      </div>

      <!-- Year -->
      <div>
        <label class="fw-semibold me-2">Year:</label>
        <div class="btn-group" role="group">
          {% for y in years %}
            <a href="?year={{ y }}" class="btn btn-sm {% if selected_year == y %}btn-success{% else %}btn-outline-success{% endif %}">{{ y }}</a>
          {% endfor %}
        </div>
      </div>

      <!-- Reset -->
      {% if selected_category or selected_year %}
        <a href="{% url 'movie:movie_list' %}" class="btn btn-sm btn-secondary">Reset Filters</a>
      {% endif %}
    </div>
  </section>

  <!-- üé• Scrollable Results -->
  <section class="panel mb-5 position-relative">
    <h3 class="text-white mb-3">Results</h3>

    <!-- ‚è™ Scroll Buttons -->
    <button class="scroll-btn left-btn btn btn-dark rounded-circle shadow" data-target="#movieScroll" aria-label="Previous">
      <i class="bi bi-chevron-left fs-5"></i>
    </button>
    <button class="scroll-btn right-btn btn btn-dark rounded-circle shadow" data-target="#movieScroll" aria-label="Next">
      <i class="bi bi-chevron-right fs-5"></i>
    </button>

    <!-- üîÑ Movie Scroll Area -->
    <div id="movieScroll" class="movie-horizontal-scroll">
      <div class="scroll-wrapper d-flex gap-4">
        {% if object_list %}
          {% for movie in object_list %}
            <div class="card movie-card bg-dark text-light border-0 shadow-sm" style="width: 200px;">
              <a href="{% url 'movie:movie_detail' movie.slug %}">
                <img src="{{ movie.image.url }}" class="card-img-top rounded-top" alt="{{ movie.title }}" onerror="this.src='{% static 'img/placeholder.png' %}'">
              </a>
              <div class="card-body p-2 text-center">
                <h6 class="card-title fw-bold text-white text-truncate" title="{{ movie.title }}">{{ movie.title }}</h6>
                <p class="card-text small text-muted mb-2">
                  ‚≠ê {{ movie.rating }}/10<br>
                  üìÖ {{ movie.year_of_production|date:"Y" }} | ‚è± {{ movie.duration }} min
                </p>
                <a href="{% url 'movie:movie_detail' movie.slug %}" class="btn btn-sm btn-outline-light">Watch Now</a>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-center w-100">
            <h4 class="text-danger">No movies found for the selected filters.</h4>
          </div>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- üìÑ Pagination -->
  {% if is_paginated %}
    <nav class="mt-4 d-flex justify-content-center">
      <ul class="pagination">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_year %}&year={{ selected_year }}{% endif %}">Previous</a>
          </li>
        {% endif %}
        {% for num in page_obj.paginator.page_range %}
          <li class="page-item {% if page_obj.number == num %}active{% endif %}">
            <a class="page-link" href="?page={{ num }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_year %}&year={{ selected_year }}{% endif %}">{{ num }}</a>
          </li>
        {% endfor %}
        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_year %}&year={{ selected_year }}{% endif %}">Next</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}

</main>

<!-- üß† Scroll Button Logic -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const scrollAmount = 320;
    document.querySelectorAll(".scroll-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const targetId = btn.dataset.target;
        const container = document.querySelector(targetId);
        const direction = btn.classList.contains("right-btn") ? 1 : -1;
        container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
      });
    });
  });
</script>
{% endblock %}
