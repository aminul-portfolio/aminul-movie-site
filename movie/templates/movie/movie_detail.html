{% extends 'base.html' %}
{% load static %}
{% load movie_filters %}

{% block body %}
<main class="page-wrapper" style="background-color: #0d0d0d; color: white; padding: 40px 20px;">
  <div class="centered-content">

    <!-- üé¨ Trailer -->
   <section class="section-block">
      <h2 class="section-title">üé¨ Trailer</h2>
      <div class="trailer-box">
        <iframe
          src="{{ object.trailer_url }}"
          title="{{ object.title }} Trailer"
          allowfullscreen
          loading="lazy"
        ></iframe>
      </div>
  </section>


    <!-- üéûÔ∏è Movie Info -->
    <section class="section-block movie-info d-flex flex-column flex-md-row gap-4 align-items-start">
      <img
        src="{{ object.image.url }}"
        alt="{{ object.title }}"
        class="movie-image img-fluid rounded shadow"
        style="max-width: 300px;"
        onerror="this.src='{% static 'img/placeholder.png' %}'"
      >
      <div class="movie-details flex-grow-1">
        <h2 class="text-info">{{ object.title }}</h2>
        <ul class="list-unstyled">
          <li><strong>üìù Description:</strong> {{ object.description }}</li>
          <li><strong>üé≠ Genres:</strong>
            {% for genre in object.genres.all %}
              <span class="badge bg-warning text-dark">{{ genre.name }}</span>
            {% empty %} N/A {% endfor %}
          </li>
          <li><strong>üë• Cast:</strong> {{ object.cast }}</li>
          <li><strong>‚≠ê Rating:</strong> {{ object.rating }}/10</li>
          <li><strong>‚è± Duration:</strong> {{ object.duration }} minutes</li>
          <li><strong>üëÅ Views:</strong> {{ object.views_count }}</li>
        </ul>
      </div>
    </section>

    <!-- üîó Watch & Download Links -->
    <section class="section-block">
      <h2 class="section-title text-center mb-4">üîó Watch & Download</h2>
      <div class="row g-4">

        <!-- üì• Download Cards -->
        <div class="col-md-6">
          <h4 class="text-warning mb-3">üì• Download Links</h4>
          <div class="row g-3">
            {% for link in links %}
              {% if link.type == "D" %}
              <div class="col-12">
                <div class="card bg-dark border border-warning shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title text-white">Download {{ forloop.counter }}</h5>
                    <p class="card-text text-muted">High quality download available.</p>
                    <a href="{{ link.link }}" target="_blank" class="btn btn-warning text-dark" aria-label="Download movie {{ object.title }}">Download</a>
                  </div>
                </div>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>

        <!-- ‚ñ∂Ô∏è Watch Cards -->
        <div class="col-md-6">
          <h4 class="text-success mb-3">‚ñ∂Ô∏è Watch Links</h4>
          <div class="row g-3">
            {% for link in links %}
              {% if link.type == "W" %}
              <div class="col-12">
                <div class="card bg-dark border border-success shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title text-white">Watch {{ forloop.counter }}</h5>
                    <p class="card-text text-muted">Stream this movie online instantly.</p>
                    <a href="{{ link.link }}" target="_blank" class="btn btn-success" aria-label="Watch movie {{ object.title }}">Watch Now</a>
                  </div>
                </div>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>

      </div>
    </section>

    <!-- üé¨ Related Movies -->
    {% if related_movies %}
    <section class="section-block">
      <h2 class="section-title">üé¨ Related Movies</h2>
      <div class="movie-horizontal-scroll">
        <div class="scroll-wrapper d-flex gap-3">
          {% for movie in related_movies %}
          <div class="movie-card text-center">
            <a href="{% url 'movie:movie_detail' movie.slug %}" class="text-decoration-none">
              <img src="{{ movie.image.url }}" class="movie-poster" alt="{{ movie.title }}"
                   onerror="this.src='{% static 'img/placeholder.png' %}'">
              <h6 class="mt-2 text-light">{{ movie.title }}</h6>
              <p class="text-muted small mb-1">‚≠ê {{ movie.rating }}/10 | ‚è± {{ movie.duration }} min</p>
              {% for genre in movie.category|split_by_comma %}
                <span class="badge bg-warning text-dark small">{{ genre|title }}</span>
              {% endfor %}
            </a>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

  </div>
</main>
{% endblock %}
